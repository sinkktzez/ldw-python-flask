{% extends "base.html" %}

{% block title %}Fotos do Álbum: {{ album.nome }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Fotos do Álbum: {{ album.nome }}</h2>
    <p>{{ album.descricao }}</p>

    <a href="{{ url_for('newPhoto', album_id=album.id) }}" class="btn btn-primary mb-3">Adicionar Nova Foto</a>

    {% if fotos %}
    <div class="row">
        {% for foto in fotos %}
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow-sm">
                {% if foto.arquivo %}
                <img src="{{ url_for('static', filename='uploads/' + foto.arquivo) }}" class="card-img-top" alt="{{ foto.titulo }}">
                {% else %}
                <img src="{{ url_for('static', filename='uploads/default.png') }}" class="card-img-top" alt="Sem imagem">
                {% endif %}
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ foto.titulo }}</h5>
                    <p class="card-text">{{ foto.descricao or '' }}</p>
                    <p class="text-muted mt-auto"><small>Criado em: {{ foto.data.strftime('%d/%m/%Y %H:%M') }}</small></p>
                </div>
                <div class="card-footer d-flex justify-content-between">
                    <a href="{{ url_for('editPhoto', photo_id=foto.id) }}" class="btn btn-warning btn-sm">Editar</a>
                    <form action="{{ url_for('deletePhoto', photo_id=foto.id) }}" method="POST" class="d-inline">
                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Deseja realmente excluir esta foto?')">Excluir</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <nav>
      <ul class="pagination">
        {% if pagination.has_prev %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('photos', album_id=album.id, page=pagination.prev_num) }}">Anterior</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Anterior</span></li>
        {% endif %}

        {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
          {% if page_num %}
            {% if page_num == pagination.page %}
              <li class="page-item active"><span class="page-link">{{ page_num }}</span></li>
            {% else %}
              <li class="page-item"><a class="page-link" href="{{ url_for('photos', album_id=album.id, page=page_num) }}">{{ page_num }}</a></li>
            {% endif %}
          {% else %}
            <li class="page-item disabled"><span class="page-link">…</span></li>
          {% endif %}
        {% endfor %}

        {% if pagination.has_next %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('photos', album_id=album.id, page=pagination.next_num) }}">Próximo</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Próximo</span></li>
        {% endif %}
      </ul>
    </nav>

    {% else %}
      <p>Nenhuma foto cadastrada neste álbum.</p>
    {% endif %}
</div>
{% endblock %}